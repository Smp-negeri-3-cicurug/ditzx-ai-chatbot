<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Chatbot</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

  <style>
    /* Reset dan Styling Dasar */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Inter', sans-serif;
      height: 100vh;
      color: #e0e6ed;
      background: radial-gradient(ellipse at bottom, #1B2735 0%, #090A0F 100%);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    .container {
      display: flex;
      flex-direction: column;
      flex: 1;
      max-width: 900px;
      margin: 1.5rem auto;
      width: 100%;
      background-color: rgba(23, 27, 46, 0.7);
      backdrop-filter: blur(15px);
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
      border-radius: 18px;
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.08);
    }
    
    /* Header */
    header {
      background-color: rgba(23, 27, 46, 0.9);
      padding: 1rem 1.5rem;
      display: flex;
      align-items: center;
      justify-content: flex-start;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    .hamburger-btn {
      background: none; border: none; font-size: 1.5rem;
      cursor: pointer; color: #e0e6ed; padding-right: 1.5rem;
      transition: transform 0.2s ease, color 0.2s ease;
    }
    .hamburger-btn:hover { transform: scale(1.1); color: #6a89cc; }
    header h1 {
      font-size: 1.3rem; font-weight: 600; flex: 1; text-align: center;
      padding-right: 2.5rem; color: #6a89cc;
    }
    
    /* Sidebar */
    .sidebar {
      position: fixed; top: 0; left: -300px;
      width: 280px; height: 100%;
      background-color: #161c28;
      box-shadow: 5px 0 15px rgba(0, 0, 0, 0.6);
      transition: left 0.4s ease;
      padding: 2rem 1.5rem;
      z-index: 1000;
    }
    .sidebar.open { left: 0; }
    .sidebar h2 {
      font-size: 1.4rem; font-weight: 700; margin-bottom: 1.5rem;
      color: #e0e6ed; border-bottom: 2px solid #6a89cc; padding-bottom: 0.5rem;
    }
    .sidebar ul { list-style-type: none; display: flex; flex-direction: column; gap: 0.75rem; }
    .sidebar button {
      width: 100%; text-align: left; padding: 1rem 1.25rem;
      background-color: #2b3445; color: #e0e6ed;
      border-radius: 12px; border: none; cursor: pointer;
      transition: background-color 0.2s ease, transform 0.2s ease;
      font-weight: 500; font-size: 1rem; display: flex; align-items: center;
    }
    .sidebar button:hover { background-color: #4a5568; transform: translateX(8px); }
    .sidebar button i { margin-right: 1rem; color: #94a3b8; }
    
    /* Area Chat */
    main {
      flex: 1; overflow-y: auto; padding: 1.5rem;
      display: flex; flex-direction: column; gap: 1.5rem;
    }
    .message-container { display: flex; gap: 1rem; align-items: flex-start; }
    .message-container.user { justify-content: flex-end; }
    .message-container.ai { justify-content: flex-start; }
    .message-icon {
      width: 40px; height: 40px; border-radius: 50%;
      display: flex; justify-content: center; align-items: center;
      font-size: 1.2rem; flex-shrink: 0;
    }
    .message-icon.user { background-color: #6a89cc; color: #fff; }
    .message-icon.ai { background-color: #3b455c; color: #6a89cc; }
    .chat-bubble {
      padding: 1rem 1.5rem; border-radius: 20px;
      max-width: 80%; line-height: 1.5;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
    }
    .chat-bubble.user { background-color: #6a89cc; color: #fff; }
    .chat-bubble.ai { background-color: #2b3445; color: #e0e6ed; }
    .chat-bubble h4 {
      font-size: 0.9rem; font-weight: 700; margin-bottom: 0.5rem;
      color: rgba(255, 255, 255, 0.8);
    }
    
    /* Footer */
    footer {
      padding: 1.5rem; border-top: 1px solid rgba(255, 255, 255, 0.1);
      background-color: rgba(23, 27, 46, 0.9);
    }
    .chat-form { display: flex; gap: 0.75rem; align-items: center; }
    .chat-form input {
      flex: 1; padding: 1rem 1.5rem; border-radius: 9999px;
      border: 1px solid #4a5568; background-color: #202a3a;
      color: #e0e6ed; font-size: 1rem;
    }
    .chat-form button {
      padding: 1rem 2rem; border-radius: 9999px;
      background-color: #6a89cc; color: #fff; font-weight: 600;
      border: none; cursor: pointer;
    }
    .chat-form button:hover { background-color: #5773ba; }
    .empty-state {
      text-align: center; color: #8c95a3; font-size: 1.3rem;
      margin: auto; opacity: 0.8;
    }
    .typing-indicator span {
      animation: typing 1s infinite;
      display: inline-block; margin: 0 2px;
    }
    @keyframes typing { 0%,100%{opacity:.2} 50%{opacity:1} }
  </style>
</head>
<body>

  <div class="container">
    <header>
      <button id="hamburger-btn" class="hamburger-btn">â˜°</button>
      <h1 id="header-title">Halo kakðŸ‘‹</h1>
    </header>

    <div id="sidebar" class="sidebar">
      <h2>Pilih Model AI</h2>
      <ul id="model-list"></ul>
    </div>

    <main id="chat-area">
      <div id="empty-state" class="empty-state">
        Selamat datang! <br> Silakan pilih model dan mulai percakapan.
      </div>
    </main>

    <footer>
      <form id="chat-form" class="chat-form" onsubmit="return false;">
        <input id="chat-input" type="text" placeholder="Ketik pesanmu..." />
        <button type="submit">Kirim</button>
      </form>
    </footer>
  </div>

  <script>
    const availableModels = [
      { id: 'gpt-4o', name: 'GPT-4o', icon: 'fa-solid fa-microchip' },
      { id: 'gpt-4.1-nano', name: 'GPT-4.1-Nano', icon: 'fa-solid fa-robot' },
      { id: 'deepseek-r1', name: 'DeepSeek R1', icon: 'fa-solid fa-brain' },
      { id: 'deepseek-v3', name: 'DeepSeek V3', icon: 'fa-solid fa-flask' },
      { id: 'claude-3.7', name: 'Claude 3.7', icon: 'fa-solid fa-cloud-sun' },
      { id: 'gemini-2.0', name: 'Gemini 2.0', icon: 'fa-solid fa-star' },
      { id: 'qwen-qwq-32b', name: 'Qwen QWQ 32B', icon: 'fa-solid fa-feather-pointed' }
    ];

    const API_BASE_URL = '/api/chat';

    const hamburgerBtn = document.getElementById('hamburger-btn');
    const sidebar = document.getElementById('sidebar');
    const modelList = document.getElementById('model-list');
    const chatForm = document.getElementById('chat-form');
    const chatInput = document.getElementById('chat-input');
    const chatArea = document.getElementById('chat-area');
    const emptyState = document.getElementById('empty-state');
    const headerTitle = document.getElementById('header-title');
    
    let selectedModel = availableModels[0];
    let initialGreeting = true;

    const updateHeaderTitle = () => { headerTitle.textContent = selectedModel.name; };

    const displayMessage = (role, content, modelName) => {
      if (initialGreeting) { emptyState.style.display = 'none'; initialGreeting = false; }

      const container = document.createElement('div');
      container.className = `message-container ${role}`;

      const icon = document.createElement('div');
      icon.className = `message-icon ${role}`;
      icon.innerHTML = role === 'user'
        ? '<i class="fa-solid fa-user"></i>'
        : `<i class="${selectedModel.icon}"></i>`;

      const bubble = document.createElement('div');
      bubble.className = `chat-bubble ${role}`;
      bubble.innerHTML = `<h4>${role === 'user' ? 'Kamu' : modelName}</h4><p>${content}</p>`;

      if (role === 'ai') {
        container.appendChild(icon); container.appendChild(bubble);
      } else {
        container.appendChild(bubble); container.appendChild(icon);
      }

      chatArea.appendChild(container);
      chatArea.scrollTop = chatArea.scrollHeight;
    };

    const handleFormSubmit = async (e) => {
      e.preventDefault();
      const userMessage = chatInput.value.trim();
      if (!userMessage) return;

      displayMessage('user', userMessage, 'Kamu');
      chatInput.value = ''; chatInput.disabled = true;

      // indikator mengetik
      const loading = document.createElement('div');
      loading.className = 'message-container ai';
      loading.innerHTML = `
        <div class="message-icon ai"><i class="${selectedModel.icon}"></i></div>
        <div class="chat-bubble ai">
          <h4>${selectedModel.name}</h4>
          <p><span class="typing-indicator"><span>.</span><span>.</span><span>.</span></span></p>
        </div>`;
      chatArea.appendChild(loading); chatArea.scrollTop = chatArea.scrollHeight;

      try {
        const url = `${API_BASE_URL}?text=${encodeURIComponent(userMessage)}&model=${selectedModel.id}`;
        const response = await fetch(url);

        if (!response.ok) throw new Error(`HTTP error ${response.status}`);

        const data = await response.json();
        const aiResponse = data.result || JSON.stringify(data);

        chatArea.removeChild(loading);
        displayMessage('ai', aiResponse, selectedModel.name);

      } catch (err) {
        console.error('Error:', err);
        chatArea.removeChild(loading);
        displayMessage('ai', 'Maaf, terjadi kesalahan. Mohon coba lagi.', 'Error');
      } finally {
        chatInput.disabled = false; chatInput.focus();
      }
    };

    const handleModelSelect = (e) => {
      const btn = e.target.closest('button');
      if (!btn) return;
      const modelId = btn.dataset.modelId;
      const model = availableModels.find(m => m.id === modelId);
      if (model) {
        selectedModel = model;
        sidebar.classList.remove('open');
        updateHeaderTitle();
      }
    };

    // isi sidebar
    availableModels.forEach(m => {
      const li = document.createElement('li');
      const btn = document.createElement('button');
      btn.innerHTML = `<i class="${m.icon}"></i> ${m.name}`;
      btn.dataset.modelId = m.id;
      btn.addEventListener('click', handleModelSelect);
      li.appendChild(btn);
      modelList.appendChild(li);
    });

    hamburgerBtn.addEventListener('click', () => sidebar.classList.toggle('open'));
    document.addEventListener('click', e => {
      if (!sidebar.contains(e.target) && !hamburgerBtn.contains(e.target)) {
        sidebar.classList.remove('open');
      }
    });

    chatForm.addEventListener('submit', handleFormSubmit);
    updateHeaderTitle();
  </script>
</body>
</html>
